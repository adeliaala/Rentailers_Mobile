ini kode login yang sudah connect API 

class LoginPage extends StatefulWidget {
  const LoginPage({super.key});

  @override
  State<LoginPage> createState() => _LoginPageState();
}

class _LoginPageState extends State<LoginPage> {
  final _formKey = GlobalKey<FormState>();
  bool isLoading = false;

  final nameController = TextEditingController();
  final passwordController = TextEditingController();

  login() async {
    setState(() {
      isLoading = true;
    });
    var keyLogin = '1';
    try {
      final res = await http.post(Uri.parse(ApiConnect.login), body: {
        "name": nameController.text,
        "password": passwordController.text,
      });
      if (res.statusCode == 200) {
        SharedPreferences sharedPreferences =
            await SharedPreferences.getInstance();

        String datauser = res.body;
        var hasiluser = jsonDecode(datauser);
        // sharedPreferences.setString('userdata', hasiluser.toString());
        var nama = hasiluser["name"];
        sharedPreferences.setString('name', nama.toString());
        var email = hasiluser["email"];
        sharedPreferences.setString('email', email.toString());
        sharedPreferences.setString('keyLogin', keyLogin);

        setState(() {
          isLoading = false;
        });
        // _showSnackBarAndNavigateToLogin();
        _showSnackBarAndNavigateToLogin("Login berhasil");
      }

      if (res.statusCode == 401) {
        setState(() {
          isLoading = false;
          _showSnackBar('Password Yang Anda Masukkan Salah');
        });
      }
      if (res.statusCode == 400) {
        setState(() {
          isLoading = false;
          _showSnackBar('Login gagal, email tidak terdaftar');
        });
      }
    } catch (e) {
      rethrow;
    }
  }

  Future<bool> _isAccountNotRegisteredYet() async {
    // Simulasi cek database
    // Ganti bagian ini dengan logika pengecekan yang sesuai
    final res = await http.post(Uri.parse(ApiConnect.login), body: {
      "name": nameController.text,
      "password": passwordController.text,
    });
    final hasil = json.decode(json.encode(res.body));

    String hasilhasil = hasil.toString();
    if (hasilhasil.contains('id')) {
      return false;
    } else {
      return true;
    }
  }

  void _showSnackBarAndNavigateToLogin(String message) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        backgroundColor: primary99Color,
        content: Row(
          children: [
            Icon(Icons.check_circle_outline, color: primary40Color, size: 50),
            const SizedBox(width: 20),
            Text(
              message,
              style: blackTextStyle.copyWith(fontWeight: medium),
            ),
          ],
        ),
        duration: const Duration(seconds: 1),
        behavior: SnackBarBehavior.floating,
      ),
    );

    // Setelah Snackbar muncul, arahkan pengguna ke halaman login
    Future.delayed(const Duration(seconds: 1), () {
      Navigator.pushAndRemoveUntil(
          context,
          MaterialPageRoute(builder: (context) => const NavigationPage()),
          (route) => false);
    });
  }

  void _showSnackBar(String message) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        backgroundColor: danger99Color,
        content: Row(
          children: [
            Icon(Icons.error_outline, color: danger40Color, size: 50),
            const SizedBox(width: 20),
            Text(
              message,
              style: blackTextStyle.copyWith(fontWeight: medium),
            ),
          ],
        ),
        duration: const Duration(seconds: 2),
        behavior: SnackBarBehavior.floating,
      ),
    );
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
        backgroundColor: lightBackgroundColor,
        appBar: AppBar(
          centerTitle: true,
          title: Text('LOGIN',
              style: bluetogreenTextStyle.copyWith(
                  fontSize: 25, fontWeight: FontWeight.bold)),
        ),
        body: SafeArea(
          child: Padding(
            padding: const EdgeInsets.only(right: 30, left: 30),
            child: SingleChildScrollView(
              //agar bisa di scroll apabila halaman kelebihan
              scrollDirection: Axis.vertical,
              child: Form(
                key: _formKey, //
                child: Column(
                  children: [
                    Padding(
                      padding: const EdgeInsets.only(top: 20),
                      child: Center(
                        child: Column(
                          children: [
                            const SizedBox(
                              height: 50,
                            ),
                            SizedBox(
                                height: 300,
                                width: 300,
                                child: Image.asset(
                                  'assets/nobg.png',
                                  fit: BoxFit.contain,
                                )),
                            const SizedBox(height: 20),
                            Text('Login dengan akun yang terdaftar',
                                style: blackTextStyle.copyWith(
                                    fontSize: 20, fontWeight: FontWeight.w400)),
                          ],
                        ),
                      ),
                    ),
                    const SizedBox(height: 50),
                    RegisterField(
                        controller: nameController,
                        isLoading: isLoading,
                        keyType: TextInputType.emailAddress,
                        hint: 'Masukkan Username',
                        validator: (val) {
                          if (val == null || val.isEmpty) {
                            return 'Kolom Username harus diisi';
                          }
                          if (!val.contains('@')) {
                            return 'Username tidak valid';
                          }
                          return null;
                        },
                        prefixIcon: Icons.mail),
                    const SizedBox(height: 20),
                    RegisterField(
                      controller: passwordController,
                      isLoading: isLoading,
                      prefixIcon: Icons.key,
                      hint: 'Masukkan password',
                      isPassword: true,
                      validator: (val) {
                        if (val == null || val.isEmpty) {
                          return 'Kolom Password harus diisi';
                        }
                        if (val.length < 8) {
                          return 'Password harus 8 karakter';
                        }
                        return null;
                      },
                    ),
                    const SizedBox(
                      height: 40,
                    ),
                    ElevatedButton(
                      onPressed: () {
                        if (_formKey.currentState!.validate()) {
                          login();
                        }
                      },
                      style: ElevatedButton.styleFrom(
                          backgroundColor: bluetogreenColor,
                          shape: RoundedRectangleBorder(
                            borderRadius: BorderRadius.circular(10),
                          )),
                      child: Container(
                        alignment: Alignment.center,
                        width: double.infinity,
                        height: 50,
                        child: isLoading
                            ? CircularProgressIndicator(
                                color: whiteColor,
                              )
                            : Text('Masuk',
                                style: whitekTextStyle.copyWith(
                                  fontWeight: bold,
                                  fontSize: 17,
                                )),
                      ),
                    ),
                    Row(
                      mainAxisAlignment: MainAxisAlignment.center,
                      children: [
                        Text('Belum memiliki akun?', style: blackTextStyle),
                        TextButton(
                            onPressed: () {
                              Navigator.pushAndRemoveUntil(
                                  context,
                                  MaterialPageRoute(
                                      builder: (context) => const SignUpPage()),
                                  (route) => false);
                            },
                            child: Text('Daftar',
                                style: bluetogreenTextStyle.copyWith(
                                    fontWeight: bold))),
                      ],
                    ),
                  ],
                ),
              ),
            ),
          ),
        ));
  }
}